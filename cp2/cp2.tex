\documentclass[12pt,letterpaper]{article}

%Note to Self:
%When Decommission? - after two months of feeling useless or right away?

\usepackage[utf8]{inputenc}
\usepackage[letterpaper,margin=1in]{geometry}
\usepackage{caption} % for table captions

\usepackage{amsmath} % for multi-line equations and piecewises
\usepackage{indentfirst} % to indent after a section
\usepackage{setspace}
\usepackage{times}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xspace}
\usepackage{verbatim} % for block comments
\usepackage{subfig} % for subfigures
\usepackage{enumitem} % for a) b) c) lists
\usepackage{tabularx}
\usepackage{cleveref}
\usepackage{xcolor}
\usepackage{soul}
\newcommand{\mathcolorbox}[2]{\colorbox{#1}{$\displaystyle #2$}}

\newcolumntype{b}{X}
\newcolumntype{s}{>{\hsize=.5\hsize}X}
\newcolumntype{m}{>{\hsize=.75\hsize}X}
\usepackage{titling}
\usepackage{minted}

\newcommand{\subtitle}[1]{%
  \posttitle{%
    \par\end{center}
    \begin{center}\large#1\end{center}
    \vskip0.5em}%
}
\usepackage{tikz}


\usetikzlibrary{shapes.geometric,arrows}
\tikzstyle{process} = [rectangle, rounded corners, minimum width=3cm, minimum height=1cm,text centered, draw=black, fill=blue!30]
\tikzstyle{arrow} = [thick,->,>=stealth]


\graphicspath{{images/}}
 
\usepackage[font={footnotesize,it}]{caption}
 
\usepackage[toc,page]{appendix}


\setlength{\parindent}{15pt} % Default is 15pt.




\fontfamily{ptm}\selectfont

\title{CP2 for NPRE 501}
\author{Jin Whan Bae}
\date{2017-12-01}


\begin{document}
	
	\maketitle
	\hrule
	\onehalfspacing
	\thispagestyle{empty}

\section*{Problem Definition}

\Cref{tab:constants} lists the constants used in the problem.


\begin{table}[h]
     \centering
    \begin{tabular}{ccc}
       \hline
       Parameter & Value & [Unit] \\
       \hline
       \multicolumn{3}{c}{Thermal Hydraulic Data}\\
       \hline
       Inlet Temperature & 563 & K \\
       Outlet Temperature & 598 & K \\
       Inlet Velocity & 350 & cm/s \\
       System Pressure at Exit & 2200 & psi \\
       \hline
       \multicolumn{3}{c}{Assembly Data} \\
       \hline
       Clad Thickness & 0.0572 & cm \\
       Fuel-Pellet Diameter & 0.819 & cm \\
       Fuel Element Pitch & 1.25 & cm \\
       Fuel Element Outer Diameter & 0.94& cm \\
       Pellet-Clad Gap & 0.0082 & cm \\
       \textbf{Outer Radius} & 0.625 & cm \\
       \textbf{Total Fuel Radius} & 0.47 & cm \\
       \textbf{Active Core Height} & 366 & cm \\
       \hline
       \multicolumn{3}{c}{Assumed Constants - Avg at 580K} \\
       \hline
       Water Density & 0.6982 & $\frac{g}{cm^3}$ \\
       Specific Heat & 5.650 & $\frac{J}{g\cdot K}$ \\
       Thermal Conductivity & 0.591 & $\frac{J}{s\cdot m\cdot k}$ \\       
       \hline
    \end{tabular}
    \caption {Problem Constants.}
    \label{tab:constants}
\end{table}

From the constants, we can derive
\begin{table}[h]
     \centering
    \begin{tabular}{cccc}
    \hline
       Derived Constant & Equation & Value & Unit \\
    \hline
       Mass Flow & $ v * \rho * A $ & 130.29 & $\frac{g}{s}$ \\
    \hline
    \end{tabular}
    \caption {Derived Constants}
    \label{tab:der_constants}
\end{table}



\section* {1. Finding Heat Generation Rate}

The heat generation rate, given the inlet and outlet temperature
at steady-state conditions, can be found using this equation:

\[\int^{V} q'''(z) dV = C_p \dot{m} (T_{out} - T_{in})\]
\[[Area] \int^{L}_{0} q'''(z) dz d\theta dr= C_p \dot{m} (35)\]

\sbusection*{Using a constant, average $C_p$ at 307.5C}
\[C_p \approx 5.650 \frac{J}{g K}\]

\[ \pi (0.47^2)  \int^{366}_{0} q'''(z) dz = 25766\]

Assuming $q'''(z) = C sin(\frac{\pi z}{L})$,
and L = 366cm:

\[ 0.6939 (366C(1-cos(\pi))) = 25766\]

\[161.69C = 25766\]
\[C = 159.34 \]

\[q'''(z) = 159.34 sin(\frac{\pi z}{L})\]

since q'(z) is $q'''(z) \cdot \pi R^2$:
\[q'(z) = 110.5 sin(\frac{\pi z}{L})\]

\subsection*{By Fitting an appropriately ordered polynomial}

The $C_p$ values are obtained using the IAPWS python
module \cite{romera_iapws_2017}. The $C_p$ values
in the range are acquired and fitted using
the polyfit function in the numpy module.

First, fitting a fifth-order polynomial we get:

\[C_p = 2.31e-09 T^5 -6.5e-6 T^4 +7.41e-3 T^3 -4.202 T^2 1.1918e3 T -1.35e5e-9\]

Considering the last three terms are minute, we reduce the 
number of orders for the polynomial fit. Fitting a second-order
polynomial fit we get:

\[C_p = 4.67e-4T^2 -5.1e-1T + 144\]

The process of looking for an `appropriate' order fit was automated
by a python code (in appendix). The results are organized in table \ref{tab:poly_fit} as well as plotted in figure \ref{fig:poly_fit}.


\begin{table}[h]
     \centering
    \begin{tabular}{cc}
       \hline
       Order Fit & C Value  \\
       \hline
       1 & 163.67 \\
       2 & 164.1 \\
       3 & 164.19 \\
       4 & 164.22 \\
       5 & 164.22 \\
       \hline
    \end{tabular}
    \caption {Polynomial Fit Order and $C_p dT$ Value.}
    \label{tab:poly_fit}
\end{table}


\begin{figure}[htbp!]
    \begin{center}
        \includegraphics[scale=0.7]{cp_plot.png}
    \end{center}
    \caption{Tempearture vs Heat Capacity from 563K to 598K}
    \label{fig:poly_fit}
\end{figure}

Thus, using the second order polynomial fit, the volumetric
and linear heat generation becomes:

\[q'''(z) = 164.1 sin(\frac{\pi z}{L})\]
\[q'''(z) = 113.8 sin(\frac{\pi z}{L})\]


\subsection*{Discuss.}
The answers to both a and b are quite similar, with minor differences.
The small difference may be due to the short temperature range where
the $C_p$ values are fitted. The little room for error is also reflected
on the almost-negligible change in the C value with change in the number of 
order fits. 




\section*{Coolant Temperature Profile}
With the heat generation found, it can be plugged back
into the energy equation to find $T_c(z)$:

\[[Area] \int^{z}_0 q'''(z) dz = \int^{T_c (z)}_{T_{in}} C_p(T) \dot{m} dT\]
\[\pi (.47^2) * 164.1 \int^{z}_0 sin(\frac{\pi z}{L})  dz =
    130.29 \int^{T_c (z)}_{T_{in}} (4.67e-4T^2 -5.1e-1T + 144)  dT\]
\[\pi (.47^2) * 164.1 * (\frac{L}{\pi} (1-cos(\frac{\pi z}{L}))) =
    130.29 (1.5e-4T^3 - .255T^2 + 144 T \Big{|}^{T_c (z)}_{T_{in}})\]

Putting numerical values instead of constants:

\[\pi (.47^2) * 164.1 * (\frac{366}{\pi} (1-cos(\frac{\pi z}{L}))) =
    130.29 (1.5e-4T^3 - .255T^2 + 144 T \Big{|}^{T_c (z)}_{563})\]

\[101.82 (1- cos(\frac{\pi z}{L})) + 27012 = 1.5e-4T_c^3 - .255T_c^2 + 144 T_c \]

\[-101.82 cos(\frac{\pi z}{L}) + 27113 = 1.5e-4T_c^3 - .255T_c^2 + 144 T_c \]

\[-101.82 cos(\frac{\pi z}{L}) = 1.5e-4T_c^3 - .255T_c^2 + 144 T_c -27113\]

\[ cos(\frac{\pi z}{L}) = -1.47e-6T_c^3 + 0.0025T_c^2 -1.41 T_c + 266\]


\pagebreak
Differential Equation:

For water channel ($R_i \leq r \leq R_o$):
\[\frac{1}{\alpha} \cdot (\frac{dT}{dt} + (V_r \frac{dT}{dr} + V_z \frac{dT}{dz})) =
  \frac{1}{dr} \frac{d}{dr} (r \frac{dT}{dr}) + \frac{d^2T}{dz^2})\]

For fuel pin ($r < R_i$):
\[\frac{1}{\alpha} \cdot (\frac{dT}{dt}) =
  \frac{1}{dr} \frac{d}{dr} (r \frac{dT}{dr}) + \frac{d^2T}{dz^2}) + \frac{q(z)}{k}\]

Boundary Conditions:
\[-k \frac{dT}{dr}(z=R_o) = 0 \]
\[\frac{dT}{dr}(r=0) = 0\]
\[-k \frac{dT}{dz}(z=0) = -k \frac{dT}{dz}(z=L) = 0 \]
 

Initial Condition:
\[T(r,0) = \frac{T_0}{2} (1-\cos{(\frac{\pi \cdot r}{R})}) \]




\begin{appendices}

\section{For fitting polynomials for Heat Capacity}

\begin{minted}{python}
def fit_poly_cp(order):
    """ fits a polynomial for Temp and C_p of Water"""
    temp = np.linspace(290+273, 320+273, 100)
    cp =[]
    for i in temp:
        cp.append(IAPWS97(T=i, P=15.17).cp)
    eq = np.polyfit(temp, cp, order)
    eq = list(reversed(eq))
    x =np.polynomial.polynomial.Polynomial(eq)
    integral = integrate.quad(x, 290+273, 325+273)
    print('Result of the Integral for order %s is:' %str(order))
    print(integral[0])
    print('C = ')
    print(132.446*integral[0] / (366*2*.47**2))
    print('\n \n')
\end{minted}


\end{appendices}
\pagebreak

-end of report.
\end{document}






